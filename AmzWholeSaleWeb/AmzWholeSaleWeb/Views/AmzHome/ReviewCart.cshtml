@model IEnumerable<AmzModel.AmzProduct>
@{
    ViewBag.Title = "Review Cart";
}
<h2> Please review your cart and click @Html.ActionLink("Checkout", "Contact", "Home") to complete your transaction</h2>
<br />
@Html.ActionLink("Take me back to home page", "Index", "AmzHome")


<script type="text/x-kendo-tmpl" id="template">
    <div class="product-view k-widget">
        <dl>
            <dt><img src="@Url.Content("~/content/products/")#:SmallImageId#" alt="#:ProductName# image" /> #:ProductDescription#</dt>
            <dd>#:ProductName#</dd>
            <dd>Price: #:kendo.toString(CostOfItemsInCart, "c")#</dd>
            <dd>Total Items: #:TotalItemsInCart#</dd>
        </dl>
        <div class="edit-buttons">
            <button id="addToCartButton" type="button" onclick="addToCart('#:ProductID#', '#:UnitPrice#', 1)">Add to cart</button>
        </div>
    </div>
</script>


<div class="demo-section k-content wide">

    @(Html.Kendo().ListView<AmzModel.AmzProduct>(Model)
    .Name("listView")
    .TagName("div")
    .ClientTemplateId("template")
    .DataSource(dataSource => dataSource
        .Model(model => model.Id("ProductID"))
        .PageSize(99)
        //.Create(create => create.Action("Editing_Create", "ListView"))
        .Read(read => read.Action("CartItems_Read", "AmzHome"))
    //.Update(update => update.Action("Editing_Update", "ListView"))
    //.Destroy(destroy => destroy.Action("Editing_Destroy", "ListView"))
    ).Pageable()
    .Editable()
    .Navigatable()
    .Selectable()
    .Events(events => events.Change("onChange").DataBound("onDataBound"))
    )
</div>


<script>
    $(document).ready(function () {
        getCartCount();
    });

    function onDataBound() {
        //alert("Data bound");
        @*if ($("#listView").data("kendoListView").dataSource.total() === 0) {
            var url = '@Url.Action("CartIsEmpty", "AmzHome")';
            window.location.href = url;
        }*@
    }

    
    function onClose() {

    }
    function onChange(arg) {
        var ds = $("#listView").data("kendoListView");
        var selectedItem = ds.dataItem(ds.select());


        document.getElementById("popUpWindowImageLarge").src = "@Url.Content("~/content/products/{0}?{1}")".format(selectedItem.LargeImageId, new Date().getTime());
        document.getElementById("popUpWindowImageMedium").src = "@Url.Content("~/content/products/{0}?{1}")".format(selectedItem.MediumImageId, new Date().getTime());
        document.getElementById("popUpWindowImageSmall").src = "@Url.Content("~/content/products/{0}?{1}")".format(selectedItem.SmallImageId, new Date().getTime());

        $("div#windowProductName").text(selectedItem.ProductName);

        $("#window").show();
        $("#window").data("kendoWindow").open();
    }

</script>

<style>
    .windowProductName {
        font-size: 18px;
        font-weight: bold;
    }

    .imageBig img {
        float: left;
        width: 500px;
        height: 500px;
        opacity: 100;
        margin-bottom: 40px;
        margin-right: 10px;
    }

    .imageMedium img {
        float: left;
        width: 300px;
        height: 300px;
        opacity: 100;
        margin-right: 10px;
    }

    .imageSmall img {
        float: left;
        width: 100px;
        height: 100px;
        opacity: 100;
        margin-bottom: 40px;
        margin-right: 0px;
    }

    .product-view {
        float: left;
        width: 100%;
        height: 300px;
        box-sizing: border-box;
        border-top: 0;
        position: relative;
    }

        .product-view img {
            float: left;
            width: 110px;
            height: 110px;
            opacity: 100;
            margin-bottom: 10px;
            margin-right: 10px;
        }

        .product-view:nth-child(even) {
            border-left-width: 0;
        }

        .product-view dl {
            margin: 10px 10px 0;
            padding: 0;
            overflow: hidden;
        }

        .product-view dt, dd {
            margin: 1;
            padding: 0;
            width: 100%;
            line-height: 20px;
            font-size: 15px;
            font-weight: normal;
        }

        .product-view dt {
            margin-right: 1;
            font-size: 13px;
            height: 16px;
            line-height: 16px;
            text-transform: none;
            opacity: 1;
            margin-left: 10px;
            word-wrap: break-word;
        }

        .product-view dd {
            height: 25px;
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
        }

            .product-view dd .k-widget,
            .product-view dd .k-textbox {
                font-size: 14px;
            }

    .k-listview {
        border-width: 1px 0 0;
        padding: 0;
        overflow: hidden;
        min-height: 298px;
    }

    .edit-buttons {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        text-align: right;
        padding: 5px;
        background-color: rgba(0,0,0,0.1);
    }

    .k-pager-wrap {
        border-top: 0;
    }

    span.k-invalid-msg {
        position: absolute;
        margin-left: 6px;
    }

    .k-add-button {
        margin-bottom: 2em;
    }

    @@media only screen and (max-width : 620px) {

        .product-view {
            width: 100%;
        }

            .product-view:nth-child(even) {
                border-left-width: 1px;
            }
    }
</style>